# CLAUDE-MISTAKES.md

AI在微信小程序开发中的常见错误和自查清单。

## 核心原则

- 微信小程序使用自己的框架（WXML/WXSS/JS），不是标准Web开发
- 路径解析基于项目根目录，相对路径容易算错
- 样式系统有限（不支持CSS自定义属性、Sass混入）
- 组件属性需要显式定义类型和默认值

## 常见错误模式

### 1. 相对路径错误
- 错误计算`import`和`@import`的向上层级（`../`）
- 忘记微信小程序根目录是`project.config.json`所在目录
- 未验证路径是否存在就提交

### 2. 样式系统误解
- 试图在WXSS中使用Sass/Less混入语法（不支持）
- 错误理解WXSS导入顺序导致的优先级问题
- 过度使用`!important`掩盖真正问题

### 3. 组件属性设计缺陷
- 默认值不符合实际使用场景
- 缺少必要的属性类型检查
- 未考虑组件在所有上下文中的行为

### 4. 框架特性误用
- 混淆`Page()`和`Component()`的生命周期
- 错误使用`getApp().globalData`的时机
- 未处理微信登录和请求队列的依赖关系

## AI自查清单

### 路径与导入
- [ ] 所有`import`语句的向上层级计算正确
- [ ] 所有`@import`的WXSS路径验证过
- [ ] 图片/资源路径使用绝对路径或正确相对路径
- [ ] 组件引用在`app.json`中注册过

### 样式与布局
- [ ] WXSS中未使用不支持的语法（混入、自定义属性）
- [ ] 导入顺序：基础混入 → 公共样式 → 页面样式
- [ ] 样式冲突已通过选择器特异性解决，而非`!important`
- [ ] 在多种屏幕尺寸下测试过布局

### 组件与逻辑
- [ ] 组件属性有合理的默认值
- [ ] 属性类型明确定义（String、Number、Array、Object）
- [ ] 生命周期函数（`attached`、`detached`）使用正确
- [ ] 事件绑定（`bind:`、`catch:`）语法正确

### 数据与状态
- [ ] API调用包装在请求队列中（如果需要`userId`）
- [ ] 使用`getApp().globalData`获取共享状态
- [ ] 本地存储（`wx.getStorageSync`）有适当的错误处理
- [ ] 数据更新通过`this.setData()`进行

### 微信特定问题
- [ ] 登录流程处理了`wx.login()`的异步性
- [ ] 遵循微信小程序的内容安全策略
- [ ] 未使用微信禁用的API或组件
- [ ] 在真机和模拟器上都测试过

## 错误预防策略

1. **路径计算**：从目标文件到源文件逐步计算`../`，不要猜测
2. **样式验证**：修改样式后立即在微信开发者工具中预览
3. **组件测试**：在孤立环境和集成环境中都测试组件
4. **代码审查**：提交前通读所有更改，关注边界情况
5. **参考现有模式**：查看项目中类似功能的实现方式

## 遇到问题时

1. 首先检查微信开发者工具的控制台错误
2. 验证文件路径和导入语句
3. 检查组件属性是否正确定义
4. 确认API端点配置正确（生产/本地）
5. 查阅微信官方文档和小程序开发指南